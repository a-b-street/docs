<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>15-minute neighborhoods explorer - A/B Street</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">A/B Street</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/a-b-street/docs/tree/main/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/a-b-street/docs/edit/main/book/src/software/fifteen_min.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="15-minute-neighborhood-explorer"><a class="header" href="#15-minute-neighborhood-explorer">15-minute neighborhood explorer</a></h1>
<p><img src="walkshed.gif" alt="walkshed" /></p>
<ul>
<li><a href="https://play.abstreet.org/0.3.49/fifteen_min.html">Web version</a></li>
<li>To run locally, get the
<a href="https://github.com/a-b-street/abstreet/releases">latest release</a> for Windows,
Mac, or Linux. After unzipping, run <code>fifteen_min.exe</code> or <code>fifteen_min</code>.</li>
<li>This page: <a href="https://15m.abstreet.org">15m.abstreet.org</a></li>
</ul>
<p>In a
<a href="https://crosscut.com/focus/2020/11/seattle-could-become-next-15-minute-city">15-minute city</a>,
most residents can reach a variety of stores, restaurants, parks, and jobs
within about a 15 minute walk or bike ride. Part of advocating for a
bike-friendly city is evaluating the zoning laws and understanding where people
live in relation to where they work, shop, and meet friends. This tool is a
prototype letting you see what's 15 minutes away from a starting point. You can
explore the shops and estimate how much street parking and how many people live
within a walkshed.</p>
<h2 id="feedback"><a class="header" href="#feedback">Feedback</a></h2>
<p>The tool is quite simple right now. If you have an idea how this could be used
for advocacy, please
<a href="https://github.com/a-b-street/abstreet/issues/393">get in touch</a>.</p>
<h2 id="implementation"><a class="header" href="#implementation">Implementation</a></h2>
<p>This section describes some of the technical implementation details.</p>
<h3 id="calculating-time-to-buildings"><a class="header" href="#calculating-time-to-buildings">Calculating time to buildings</a></h3>
<p>When you click on a starting building, what happens? Follow along with the code:
<a href="https://github.com/a-b-street/abstreet/blob/master/apps/fifteen_min/src/isochrone.rs">https://github.com/a-b-street/abstreet/blob/master/apps/fifteen_min/src/isochrone.rs</a></p>
<p>First, we calculate the time to reach all buildings on the map from the start,
based on the current options for walking or biking. For walking, this calls
<a href="https://github.com/a-b-street/abstreet/blob/master/map_model/src/connectivity/walking.rs">all_walking_costs_from</a>.
This method simply performs
<a href="https://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra's maneuever</a>,
floodfilling a graph from the start node and tracking the cost to reach other
nodes. It terminates early when the cost exceeds 15 minutes.</p>
<p>One relevant detail is that the graph is based off of <code>WalkingNodes</code>, which
represent both endpoints of a sidewalk. A building exists some distance along a
sidewalk. To calculate the final cost to a building, we also add up the cost
between the nearest end of the sidewalk and the building's exact position along
the sidewalk. This calculation doesn't use the length of the building's
driveway/front path, but it could.</p>
<p>The other question is how we calculate the cost to cross a sidewalk. The units
are durations, and most of the time, we simply calculate <code>distance / speed</code>. The
base speed for walking can be configured in the 15m tool UI, with a few pre-set
values for jogging, using a wheelchair, or a general average for adults. We also
<a href="https://github.com/a-b-street/abstreet/blob/8826af31cba342662694014e549322a727605339/map_model/src/traversable.rs#L315">adjust speed based on the road's incline</a>,
using a variation of
<a href="https://en.wikipedia.org/wiki/Tobler%27s_hiking_function">Tobler's hiking function</a>.
The elevation data baked into the map model likely has bugs, which then affect
walking speed.</p>
<p>In the future, we'll keep expanding this definition of "cost" to capture other
factors that make it safe and pleasant to walk, so that the 15m tool ultimately
reflects how awful it'd be to access essential services by walking along a busy
arterial road.</p>
<h3 id="drawing-the-isochrone"><a class="header" href="#drawing-the-isochrone">Drawing the isochrone</a></h3>
<p>Now that we have the cost to reach a bunch of buildings, we want to draw the
three-colored isochrone, showing the area reachable within 5, 10, and 15
minutes. We use the <a href="https://crates.io/crates/contour">contour</a> crate to do
this, which uses the
<a href="https://en.wikipedia.org/wiki/Marching_squares">marching squares algorithm</a> to
find the "contour" where the cost changes from less than 5 to over 5 minutes.</p>
<p>In my mind, an isochrone contour algorithm could just take the list of (point,
cost) pairs as input, but marching squares requires a grid, so
<a href="https://github.com/a-b-street/abstreet/blob/8826af31cba342662694014e549322a727605339/fifteen_min/src/isochrone.rs#L126">the code</a>
first creates that grid, using a fixed 100 meter cell size. If two buildings
happen to map to the same square, the cost of one of them is used arbitrarily.
It shouldn't matter much; it takes around 30 seconds to walk 100 meters, so the
contour might be a little off by about that much.</p>
<p><img src="gaps.png" alt="gaps" /></p>
<p>You can see some gaps in the middle of the park. Because there are no buildings
in the middle, the grid cell has 0 cost in there. There's probably some
<a href="https://github.com/a-b-street/abstreet/issues/669">better approaches</a> to
calculating isochrones.</p>
<h3 id="finding-the-perfect-home"><a class="header" href="#finding-the-perfect-home">Finding the perfect home</a></h3>
<p>The tool also has a feature that lets you mark what categories of amenities you
care about, then it finds houses within a 15 min walk of all of those. Its
implementation is
<a href="https://github.com/a-b-street/abstreet/blob/8826af31cba342662694014e549322a727605339/fifteen_min/src/find_home.rs#L84">laughably brute-force</a>.
For each of the categories, it finds all stores matching that category, then
does the Dijkstra's floodfill from each of those buildings. An obvious speedup
here would be to perform Dijkstra's just once for each category and insert all
of the stores into the priority queue as starting nodes.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../software/ungap_the_map/tech_details.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../software/santa.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../software/ungap_the_map/tech_details.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../software/santa.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
